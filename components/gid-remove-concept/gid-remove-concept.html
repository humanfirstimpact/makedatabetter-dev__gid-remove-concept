<!--
  Wrapper component for removing concepts
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../gid-api/gid-api.html">
<!--
`gid-remove-concept`

A data component to remove concept

    <gid-remove-concept user='1' concept='10002' remove=true response={{response}}>
    </gid-remove-concept>
    
The properties 'concept', 'user' and 'remove' are mandatory.

The field 'remove' needs to be set to 'true' in order to remove a concept.

The field 'response' returns the response provided by the rest call.

If 'apiUrl' is not provided, then the component would fetch sample data from mock json.

API endpoint:

    DELETE /domains/{id}

Input:

- Domain Id
- User Id
	
Output:

      {
        "message" : "Domain removed successfully"
      }.


@demo demo/index.html
-->
<dom-module id="gid-remove-concept">
  <template>
          <!-- fetch entity path  -->
        	<gid-api entity = '{{apiEntity}}' path-key= '{{pathKey}}' path='{{path}}'></gid-api>
        <!--  fetch entity path -->
        
         <!-- fetch concept details -->	
			<gid-api auto=false
			method="DELETE" api-url={{removeConceptUrl}} api-content-type="application/x-www-form-urlencoded"
			response='{{removeConceptResponse}}' error ='{{removeConceptErrorResponse}}'
			api-params={{removeConceptParams}} api-token = {{removeConceptToken}}
		    api-timeout={{removeConceptTimeout}}>
		    </gid-api>			
	    <!-- fetch concept details -->

  </template>
  <script>
    (function() {
     'use strict';
      Polymer({
        is:'gid-remove-concept',
        properties:{
	        	apiToken: {
	            	type: String,
	                notify: true,
	                value : ''
	            },
	        	apiUrl:{
	            	type: String,
	    	        notify: true,
	    	        value: ''
	    	 	},
	    	 	removeConceptUrl:{
                	type: String,
        	        notify: true
        	 	},
        	 	removeConceptTimeout : {
            		type: Number,
        	        notify: true,
        	        value : 0
        	    },
        	    removeConceptResponse : {
	     	  		type : Object,
	     	  		notify : true,
	     	  		observer : 'removeConceptResponseReceived'
        	  	},
        	  	removeConceptErrorResponse : {
		 	   		type: String,
	 	   	    	notify: true,
	 	   	    	observer : 'removeConceptErrorReceived'
	 	   		},
        	  	removeConceptParams : {
	     	   		type: String,
	     	   		notify : true
     	   	    },
     	   		removeConceptToken : {
	     	   		type: String,
	     	   		notify : true
     	   	    },
	     	    response: {
     	          type: Object,
     	          value: {},
     	          notify: true
     	        },
              	user: {
     	        	type: String,
     	        	value : '',
     	        	notify :  true
     	        },
     	        concept: {
     	        	type: String,
     	        	value: '',
     	        	notify: true
     	        },
     	       	pathKey: {
               	   type: String,
                   notify: true,
                   value: ''
                },
                path: {
               	   type: String,
                   notify: true,
                   value: '',
                   observer: 'pathReceived'
                },
                apiEntity: {
               	   type: String,
                   notify: true
                },
                remove: {
               		type: Boolean,
            		notify: true,
            		value: false,
            		observer: 'removeConcept'
               	}
                
               
        },
        removeConceptResponseReceived : function(newvalue, oldvalue){
          this.reset(); 
	          if(newvalue != null){
		             this.async(function() {
		         		this.response =  newvalue;
		   		 	          }, 500);
	          }
         	
         },
         removeConceptErrorReceived :  function(newvalue, oldvalue){
   		  	 this.reset();
	        	if(newvalue !== null){
	        		this.async(function() {
		         		this.response =  newvalue.response;
		   		 	          }, 500);
	        	}
	     },
	     reset: function(){
	    	 this.response = [];
	    	 this.apiEntity = '';
          	 this.path = '';
		     this.remove = false;
	     },
         removeConcept: function () {
        	 if (this.remove) {
        	 	if (!this.apiUrl) {
// 	      			this.removeConceptUrl = this.importPath + 'assets/json/remove-concept.json';
// 	                this.removeConceptTimeout =  this.removeConceptTimeout - 1;
      			}
        		else {
        			this.pathKey =  'default';
         			this.apiEntity = 'REMOVE-CONCEPT';
         		}
         	}
				
         },
         pathReceived: function(){
         	if(this.path){
         		var res = this.path.split(/{([^}]+)}/);
         		for (var i in res) {
         			if(!res[i].startsWith("/")){
         					if(this[res[i]]){
         						res[i] = this[res[i]];
         					}
         			}
         		}
       			this.removeConceptUrl = this.apiUrl + res.join("");
       			if(this.apiToken){
       				this.removeConceptToken =  this.apiToken;
       			}
       			this.removeConceptTimeout =  this.removeConceptTimeout - 1;
         		
         	}
         }
      });
    })();
  </script>
</dom-module>
